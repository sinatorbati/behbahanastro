<!DOCTYPE html>
<html lang="ÙØ§">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title><%= article.title %></title>
  <link rel="stylesheet" href="/style.css" />
  <link rel="stylesheet" href="/public/articles.css" />
  <style>
    .back-arrow { position: absolute; top: 110px; left: 20px; z-index: 10; }
    .back-arrow a { display: inline-flex; align-items: center; gap: 6px; background: rgba(0,0,0,0.05); border: 1px solid #e5e7eb; padding: 8px 12px; border-radius: 999px; color: #111827; text-decoration: none; }
    .back-arrow a:hover { background: #eef2ff; color: #3730a3; border-color: #c7d2fe; }
    /* Lightbox */
    .lb__overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.8); display: none; align-items: center; justify-content: center; z-index: 1000; }
    .lb__overlay.is-open { display: flex; }
    .lb__content { position: relative; max-width: 90vw; max-height: 90vh; }
    .lb__img { max-width: 90vw; max-height: 90vh; object-fit: contain; border-radius: 8px; box-shadow: 0 10px 30px rgba(0,0,0,0.4); }
    .lb__close { position: absolute; top: -12px; right: -12px; background: rgba(0,0,0,0.7); color: #fff; border: 0; width: 36px; height: 36px; border-radius: 50%; cursor: pointer; font-size: 18px; display: flex; align-items: center; justify-content: center; }
    .lb__nav { position: absolute; top: 50%; transform: translateY(-50%); width: 44px; height: 44px; border-radius: 50%; border: 0; background: rgba(0,0,0,0.6); color: #fff; cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 18px; }
    .lb__prev { left: -56px; }
    .lb__next { right: -56px; }
    @media (max-width: 640px) {
      .lb__prev { left: -10px; }
      .lb__next { right: -10px; }
    }
    /* Cover centering */
    .cover { text-align: center; display: flex; justify-content: center; align-items: center; }
    .cover img { max-width: 100%; height: auto; display: block; margin: 0 auto; }
    /* Thumbnails hover + zoom icon */
    .cover.lb-thumb-wrap { display: flex; justify-content: center; }
    .lb-thumb-wrap { position: relative; display: inline-block; border-radius: 8px; overflow: hidden; }
    .lightbox-thumb { display: block; transition: transform .2s ease, box-shadow .2s ease; }
    .lb-thumb-wrap::after { content: 'ğŸ”'; position: absolute; inset: 0; display: flex; align-items: center; justify-content: center; font-size: 28px; color: #fff; background: rgba(0,0,0,0.18); opacity: 0; transition: opacity .2s ease; pointer-events: none; }
    .lb-thumb-wrap:hover::after { opacity: 1; }
    .lb-thumb-wrap:hover .lightbox-thumb { transform: scale(1.03); box-shadow: 0 10px 20px rgba(0,0,0,0.2); }
    .lb-thumb-wrap { cursor: zoom-in; }
  </style>
</head>
<body class="article-show">
  <!-- Header copied from homepage -->
  <nav class="mainNav mainNav--purple">
    <div class="mainNav__logo">
      <span class="logo-icon">ğŸ”­</span>
      <span class="logo-text">BEHBAHAN ASTRO</span>
    </div>
    
    <div class="mainNav__links">
      <a href="/" class="mainNav__link">ØµÙØ­Ù‡ Ø§ØµÙ„ÛŒ</a>
      <a href="/articles" class="mainNav__link">Ù…Ù‚Ø§Ù„Ø§Øª</a>
      <a href="/news" class="mainNav__link">Ø§Ø®Ø¨Ø§Ø± Ø§Ù†Ø¬Ù…Ù†</a>
      <a href="/#contact" class="mainNav__link">ØªÙ…Ø§Ø³</a>
    </div>
    
    <div class="mainNav__social">
      <a href="#" class="social-icon" title="ØªÙ„Ú¯Ø±Ø§Ù…">ğŸ“±</a>
      <a href="#" class="social-icon" title="ÙˆØ§ØªØ³Ø§Ù¾">ğŸ“</a>
      <a href="#" class="social-icon" title="Ø§ÛŒÙ†Ø³ØªØ§Ú¯Ø±Ø§Ù…">ğŸ“·</a>
    </div>
    
    <div class="mainNav__icon">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
         <g data-name="Layer 2" fill="#9197AE">
            <g data-name="menu-2">
               <rect
                  width="24"
                  height="24"
                  transform="rotate(180 12 12)"
                  opacity="0"
               />
               <circle cx="4" cy="12" r="1" />
               <rect x="7" y="11" width="14" height="2" rx=".94" ry=".94" />
               <rect x="3" y="16" width="18" height="2" rx=".94" ry=".94" />
               <rect x="3" y="6" width="18" height="2" rx=".94" ry=".94" />
            </g>
         </g>
      </svg>
    </div>
  </nav>

  <div class="back-arrow"><a href="/articles">â† Ø¨Ø§Ø²Ú¯Ø´Øª</a></div>

  <section class="article-hero" style="padding-top:120px">
    <div class="container">
      <nav class="breadcrumbs" aria-label="breadcrumb">
        <a href="/">ØµÙØ­Ù‡ Ø§ØµÙ„ÛŒ</a>
        <span class="crumb-sep">â€º</span>
        <a href="/articles">Ù…Ù‚Ø§Ù„Ø§Øª</a>
      </nav>
      <h1 class="page-title"><%= article.title %></h1>
      <p class="page-subtitle"><%= article.summary %></p>
      <div class="meta-row">
        <span class="meta-chip"><span class="emoji">ğŸ“…</span> Ù…Ù†ØªØ´Ø± Ø´Ø¯Ù‡: <%= new Date(article.createdAt).toLocaleDateString('fa-IR') %></span>
        <a id="share-tg" class="meta-chip" href="#" target="_blank"><span class="emoji">ğŸ“¨</span> ØªÙ„Ú¯Ø±Ø§Ù…</a>
        <a id="share-wa" class="meta-chip" href="#" target="_blank"><span class="emoji">ğŸŸ¢</span> ÙˆØ§ØªØ³Ø§Ù¾</a>
      </div>
      <% if (article.image) { %>
        <div class="cover lb-thumb-wrap" style="margin-top:18px">
          <img class="lightbox-thumb" data-index="0" src="/<%= article.image %>" alt="<%= article.title %>" />
        </div>
      <% } %>
    </div>
  </section>

  <section>
    <div class="container">
      <article class="content"><%- article.content %></article>
    </div>
  </section>

  <!-- Footer copied from homepage -->
  <footer class="footer">
    <div class="container">
      <div class="footer-content">
        <div class="footer-section">
          <h3>Ø§Ù†Ø¬Ù…Ù† Ù†Ø¬ÙˆÙ… Ø¨Ù‡Ø¨Ù‡Ø§Ù†</h3>
          <p>Ú©Ø§ÙˆØ´ Ø¯Ø± Ø§Ø¹Ù…Ø§Ù‚ Ø¢Ø³Ù…Ø§Ù† Ùˆ Ú©Ø´Ù Ø±Ù…Ø² Ùˆ Ø±Ø§Ø²Ù‡Ø§ÛŒ Ú©ÛŒÙ‡Ø§Ù†</p>
        </div>
        <div class="footer-section">
          <h4>Ø¯Ø³ØªØ±Ø³ÛŒ Ø³Ø±ÛŒØ¹</h4>
          <ul class="footer-links">
            <li><a href="#">Ø¯Ø±Ø¨Ø§Ø±Ù‡ Ù…Ø§</a></li>
            <li><a href="/articles">Ù…Ù‚Ø§Ù„Ø§Øª</a></li>
            <li><a href="#">Ø¯ÙˆØ±Ù‡â€ŒÙ‡Ø§</a></li>
            <li><a href="#">ØªÙ…Ø§Ø³</a></li>
          </ul>
        </div>
        <div class="footer-section">
          <h4>Ø´Ø¨Ú©Ù‡â€ŒÙ‡Ø§ÛŒ Ø§Ø¬ØªÙ…Ø§Ø¹ÛŒ</h4>
          <div class="social-links">
            <a href="#" class="social-link">ğŸ“± ØªÙ„Ú¯Ø±Ø§Ù…</a>
            <a href="#" class="social-link">ğŸ“ ÙˆØ§ØªØ³Ø§Ù¾</a>
            <a href="#" class="social-link">ğŸ“· Ø§ÛŒÙ†Ø³ØªØ§Ú¯Ø±Ø§Ù…</a>
          </div>
        </div>
      </div>
      <div class="footer-bottom">
        <p>&copy; Û±Û´Û°Û³ Ø§Ù†Ø¬Ù…Ù† Ù†Ø¬ÙˆÙ… Ø¨Ù‡Ø¨Ù‡Ø§Ù†. ØªÙ…Ø§Ù…ÛŒ Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸ Ø§Ø³Øª.</p>
      </div>
    </div>
  </footer>
  <!-- Lightbox markup -->
  <div class="lb__overlay" id="lightbox" aria-hidden="true">
    <div class="lb__content">
      <button class="lb__nav lb__prev" aria-label="Ù‚Ø¨Ù„ÛŒ" id="lbPrev">â®</button>
      <img class="lb__img" id="lbImg" alt="" />
      <button class="lb__nav lb__next" aria-label="Ø¨Ø¹Ø¯ÛŒ" id="lbNext">â¯</button>
      <button class="lb__close" aria-label="Ø¨Ø³ØªÙ†" id="lbClose">âœ•</button>
    </div>
  </div>
  <script>
    (function() {
      // build share links on client to avoid server req dependency
      try {
        var tg = document.getElementById('share-tg');
        var wa = document.getElementById('share-wa');
        var currentUrl = window.location.href;
        var title = document.querySelector('.page-title')?.textContent || '';
        if (tg) tg.href = 'https://t.me/share/url?url=' + encodeURIComponent(currentUrl) + '&text=' + encodeURIComponent(title);
        if (wa) wa.href = 'https://wa.me/?text=' + encodeURIComponent(title + '\n' + currentUrl);
      } catch(e) {}

      // Get all images including those in article content and galleries
      const allImages = Array.from(document.querySelectorAll('.lightbox-thumb, .content img'));
      if (!allImages.length) return;

      // Build sources in index order
      const sources = allImages
        .sort((a, b) => {
          const aIndex = Number(a.dataset.index || 0);
          const bIndex = Number(b.dataset.index || 0);
          return aIndex - bIndex;
        })
        .map(el => el.getAttribute('src'));

      const overlay = document.getElementById('lightbox');
      const imgEl = document.getElementById('lbImg');
      const btnPrev = document.getElementById('lbPrev');
      const btnNext = document.getElementById('lbNext');
      const btnClose = document.getElementById('lbClose');
      let current = 0;

      function show(index) {
        if (!sources.length) return;
        current = (index + sources.length) % sources.length;
        imgEl.src = sources[current];
      }

      function openAt(index) {
        overlay.classList.add('is-open');
        overlay.setAttribute('aria-hidden', 'false');
        show(index);
        document.body.style.overflow = 'hidden';
      }

      function close() {
        overlay.classList.remove('is-open');
        overlay.setAttribute('aria-hidden', 'true');
        document.body.style.overflow = '';
      }

      // Make all images clickable for lightbox
      allImages.forEach((el, index) => {
        el.style.cursor = 'zoom-in';
        
        // Add hover effect for content images
        if (el.closest('.content')) {
          el.style.transition = 'transform 0.2s ease, box-shadow 0.2s ease';
          el.addEventListener('mouseenter', function() {
            this.style.transform = 'scale(1.02)';
            this.style.boxShadow = '0 15px 35px rgba(0,0,0,0.15)';
          });
          el.addEventListener('mouseleave', function() {
            this.style.transform = 'scale(1)';
            this.style.boxShadow = '0 10px 30px rgba(0,0,0,0.06)';
          });
        }
        
        el.addEventListener('click', () => openAt(index));
      });

      // Invert arrows: left -> next, right -> prev
      btnPrev.addEventListener('click', () => show(current + 1));
      btnNext.addEventListener('click', () => show(current - 1));
      btnClose.addEventListener('click', close);
      overlay.addEventListener('click', (e) => { if (e.target === overlay) close(); });

      document.addEventListener('keydown', (e) => {
        if (!overlay.classList.contains('is-open')) return;
        if (e.key === 'Escape') close();
        // Left arrow -> next, Right arrow -> previous
        if (e.key === 'ArrowLeft') show(current + 1);
        if (e.key === 'ArrowRight') show(current - 1);
      });

      // Basic swipe support
      let touchStartX = 0;
      overlay.addEventListener('touchstart', (e) => { touchStartX = e.changedTouches[0].clientX; }, { passive: true });
      overlay.addEventListener('touchend', (e) => {
        const dx = e.changedTouches[0].clientX - touchStartX;
        if (Math.abs(dx) > 40) {
          if (dx > 0) show(current - 1); else show(current + 1);
        }
      }, { passive: true });
    })();
  </script>
</body>
</html>


